// ==UserScript==
// @name         p-i-x-i-v
// @namespace    https://github.com/dicaurophro/la_duyen_sau/raw/main/p-i-x-i-v.user.js
// @version      2023.09.12
// @description  down p-i-x-i-v
// @author       You
// @match        https://comic.pixiv.net/viewer/stories/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=comic.pixiv.net
// @require      https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js
// @grant        none
// @downloadURL  https://github.com/dicaurophro/la_duyen_sau/raw/main/p-i-x-i-v.user.js
// @updateURL    https://github.com/dicaurophro/la_duyen_sau/raw/main/p-i-x-i-v.meta.js
// ==/UserScript==

const a0_0x594daf=a0_0x4573;(function(_0x38e618,_0x16f86f){const _0x4e0c54=a0_0x4573,_0x4c5d2e=_0x38e618();while(!![]){try{const _0x1a74d4=-parseInt(_0x4e0c54(0x1a7))/0x1*(parseInt(_0x4e0c54(0x1a2))/0x2)+parseInt(_0x4e0c54(0x143))/0x3+parseInt(_0x4e0c54(0x18c))/0x4*(parseInt(_0x4e0c54(0x166))/0x5)+-parseInt(_0x4e0c54(0x18e))/0x6+parseInt(_0x4e0c54(0x153))/0x7+parseInt(_0x4e0c54(0x15b))/0x8+-parseInt(_0x4e0c54(0x160))/0x9*(parseInt(_0x4e0c54(0x171))/0xa);if(_0x1a74d4===_0x16f86f)break;else _0x4c5d2e['push'](_0x4c5d2e['shift']());}catch(_0xdd15b1){_0x4c5d2e['push'](_0x4c5d2e['shift']());}}}(a0_0x4394,0x68555));let downloading_current=0x0,downloading_total=0x0;function sleep(_0x2fe585){return new Promise(_0x673a35=>setTimeout(_0x673a35,_0x2fe585));}function tj(_0x497dd9,_0x8a32f1){return(_0x497dd9<<(_0x8a32f1%=0x20)>>>0x0|_0x497dd9>>>0x20-_0x8a32f1)>>>0x0;}function a0_0x4573(_0xa85429,_0x1c158e){const _0x43944b=a0_0x4394();return a0_0x4573=function(_0x4573e3,_0x54bf39){_0x4573e3=_0x4573e3-0x13e;let _0x19b011=_0x43944b[_0x4573e3];return _0x19b011;},a0_0x4573(_0xa85429,_0x1c158e);}class ty{[a0_0x594daf(0x174)](){let _0x5a2859=0x9*tj(0x5*this['s'][0x1]>>>0x0,0x7)>>>0x0,_0x51fb51=this['s'][0x1]<<0x9>>>0x0;return this['s'][0x2]=(this['s'][0x2]^this['s'][0x0])>>>0x0,this['s'][0x3]=(this['s'][0x3]^this['s'][0x1])>>>0x0,this['s'][0x1]=(this['s'][0x1]^this['s'][0x2])>>>0x0,this['s'][0x0]=(this['s'][0x0]^this['s'][0x3])>>>0x0,this['s'][0x2]=(this['s'][0x2]^_0x51fb51)>>>0x0,this['s'][0x3]=tj(this['s'][0x3],0xb),_0x5a2859;}constructor(_0x24dd4){const _0x1a3469=a0_0x594daf;if(0x4!==_0x24dd4[_0x1a3469(0x1a3)])throw Error(_0x1a3469(0x187)[_0x1a3469(0x182)](_0x24dd4['length'],')'));this['s']=new Uint32Array(_0x24dd4),0x0===this['s'][0x0]&&0x0===this['s'][0x1]&&0x0===this['s'][0x2]&&0x0===this['s'][0x3]&&(this['s'][0x0]=0x1);}}async function t_(_0x215b92,_0x101fea,_0x570653,_0x11d37b,_0x52053a,_0x1b7054,_0x10bd29,_0x2f2740,_0x5c4de4){const _0x1d2029=a0_0x594daf;let _0x2b5b46=globalThis[_0x1d2029(0x148)],_0x26a9b2=Math[_0x1d2029(0x164)](_0x11d37b/_0x1b7054),_0x4b6c8a=Math['floor'](_0x570653/_0x52053a),_0x64369=Array(_0x26a9b2)[_0x1d2029(0x193)](null)['map'](()=>Array[_0x1d2029(0x14f)](Array(_0x4b6c8a)[_0x1d2029(0x19d)]()));{let _0x5a5242=new TextEncoder()[_0x1d2029(0x196)](_0x10bd29+_0x2f2740),_0x1a2cbd=await _0x2b5b46[_0x1d2029(0x149)]['digest'](_0x1d2029(0x190),_0x5a5242),_0x4a08e9=new Uint32Array(_0x1a2cbd,0x0,0x4),_0x1c37d2=new ty(_0x4a08e9);for(let _0x465232=0x0;_0x465232<0x64;_0x465232++)_0x1c37d2[_0x1d2029(0x174)]();for(let _0x4862c7=0x0;_0x4862c7<_0x26a9b2;_0x4862c7++){let _0x5dd657=_0x64369[_0x4862c7];for(let _0x5c69c2=_0x4b6c8a-0x1;_0x5c69c2>=0x1;_0x5c69c2--){let _0x28545b=_0x1c37d2['next']()%(_0x5c69c2+0x1),_0x5d09e8=_0x5dd657[_0x5c69c2];_0x5dd657[_0x5c69c2]=_0x5dd657[_0x28545b],_0x5dd657[_0x28545b]=_0x5d09e8;}}}if(_0x5c4de4)for(let _0x1d4296=0x0;_0x1d4296<_0x26a9b2;_0x1d4296++){let _0x4ad5ba=_0x64369[_0x1d4296],_0x15f337=_0x4ad5ba[_0x1d2029(0x185)]((_0x2dfbf9,_0xef234e)=>_0x4ad5ba[_0x1d2029(0x183)](_0xef234e));if(_0x15f337[_0x1d2029(0x19c)](_0x40c47a=>_0x40c47a<0x0))throw Error(_0x1d2029(0x13f));_0x64369[_0x1d4296]=_0x15f337;}let _0x1163c5=new Uint8ClampedArray(_0x215b92[_0x1d2029(0x1a3)]);for(let _0x53e97a=0x0;_0x53e97a<_0x11d37b;_0x53e97a++){let _0x33fad0=Math[_0x1d2029(0x15d)](_0x53e97a/_0x1b7054),_0x26af2f=_0x64369[_0x33fad0];for(let _0x587e7b=0x0;_0x587e7b<_0x4b6c8a;_0x587e7b++){let _0x106020=_0x26af2f[_0x587e7b],_0x494e6e=_0x587e7b*_0x52053a,_0x8aa88b=(_0x53e97a*_0x570653+_0x494e6e)*_0x101fea,_0x22f55c=_0x106020*_0x52053a,_0x420443=(_0x53e97a*_0x570653+_0x22f55c)*_0x101fea,_0x1daccf=_0x52053a*_0x101fea;for(let _0x2e8a5=0x0;_0x2e8a5<_0x1daccf;_0x2e8a5++)_0x1163c5[_0x8aa88b+_0x2e8a5]=_0x215b92[_0x420443+_0x2e8a5];}{let _0x43427b=_0x4b6c8a*_0x52053a,_0x311d76=(_0x53e97a*_0x570653+_0x43427b)*_0x101fea,_0x1e29cf=(_0x53e97a*_0x570653+_0x570653)*_0x101fea;for(let _0x367489=_0x311d76;_0x367489<_0x1e29cf;_0x367489++)_0x1163c5[_0x367489]=_0x215b92[_0x367489];}}return _0x1163c5;}const download_not_encrypted=async(_0x309fd8,_0x3ece4e)=>{const _0x3a6ef9=a0_0x594daf,_0x595ef3=await fetch(_0x309fd8[_0x3a6ef9(0x192)],{'method':_0x3a6ef9(0x198),'headers':{'X-Cobalt-Thumber-Parameter-GridShuffle-Key':_0x309fd8[_0x3a6ef9(0x1a6)],'referer':_0x3a6ef9(0x17e)}}),_0x11a6d1=await _0x595ef3['blob'](),_0x1f8358=window[_0x3a6ef9(0x156)]||window[_0x3a6ef9(0x163)],_0x132a90=_0x1f8358[_0x3a6ef9(0x151)](_0x11a6d1);let _0x578486=new Image(_0x309fd8[_0x3a6ef9(0x175)],_0x309fd8[_0x3a6ef9(0x18b)]);_0x578486['onload']=async()=>{const _0x170d68=_0x3a6ef9,_0x533edc=document[_0x170d68(0x19f)](_0x170d68(0x169));let _0x933570=_0x533edc[_0x170d68(0x14c)]('2d');_0x533edc[_0x170d68(0x175)]=_0x309fd8[_0x170d68(0x175)],_0x533edc[_0x170d68(0x18b)]=_0x309fd8[_0x170d68(0x18b)],_0x933570['drawImage'](_0x578486,0x0,0x0);let _0x4f1450=_0x933570[_0x170d68(0x16a)](0x0,0x0,_0x309fd8['width'],_0x309fd8[_0x170d68(0x18b)]),_0x5057a2=await t_(_0x4f1450[_0x170d68(0x157)],0x4,_0x309fd8[_0x170d68(0x175)],_0x309fd8[_0x170d68(0x18b)],_0x309fd8[_0x170d68(0x16e)],_0x309fd8[_0x170d68(0x16e)],_0x170d68(0x172),_0x309fd8[_0x170d68(0x1a6)],!0x0),_0xbca53b=new ImageData(_0x5057a2,_0x309fd8[_0x170d68(0x175)],_0x309fd8[_0x170d68(0x18b)]);_0x933570[_0x170d68(0x16f)](_0xbca53b,0x0,0x0),_0x533edc[_0x170d68(0x14a)](_0x519120=>{const _0x413373=_0x170d68;saveAs(_0x519120,(''+(_0x3ece4e+0x1))[_0x413373(0x181)](0x3,'0')+_0x413373(0x18f)),downloading_current+=0x1,update_status();},_0x170d68(0x189),0.97);},_0x578486[_0x3a6ef9(0x15e)]=_0x132a90;};function update_status(){const _0x2ed154=a0_0x594daf;document[_0x2ed154(0x161)](_0x2ed154(0x179))[_0x2ed154(0x1a0)][_0x2ed154(0x17a)]=_0x2ed154(0x14e),document[_0x2ed154(0x161)](_0x2ed154(0x179))[_0x2ed154(0x17d)]=downloading_current+_0x2ed154(0x144)+downloading_total;}function create_status_box(){const _0x36c151=a0_0x594daf;let _0x3082b9=document[_0x36c151(0x19f)](_0x36c151(0x19e));return _0x3082b9['className']=_0x36c151(0x146),_0x3082b9[_0x36c151(0x152)]=downloading_current+'\x20/\x20'+downloading_total,_0x3082b9;}function create_download_icon(){const _0x4173ab=a0_0x594daf;let _0xa540cc=document[_0x4173ab(0x19f)](_0x4173ab(0x19e)),_0x2047e9=document[_0x4173ab(0x19f)](_0x4173ab(0x17f));_0x2047e9[_0x4173ab(0x17b)](_0x4173ab(0x15e),_0x4173ab(0x14b)),_0x2047e9[_0x4173ab(0x1a0)]['width']=_0x4173ab(0x184),_0x2047e9[_0x4173ab(0x1a0)][_0x4173ab(0x155)]=_0x4173ab(0x19a),_0xa540cc[_0x4173ab(0x13e)](_0x2047e9);let _0x1b09fe=document['createElement'](_0x4173ab(0x165));_0x1b09fe[_0x4173ab(0x186)]=_0x4173ab(0x18a),_0x1b09fe['href']=_0x4173ab(0x1a8),document[_0x4173ab(0x170)](_0x4173ab(0x1a4))[0x0][_0x4173ab(0x13e)](_0x1b09fe);let _0x2ab8cf=document['createElement'](_0x4173ab(0x19e));_0x2ab8cf[_0x4173ab(0x188)]=_0x4173ab(0x154),_0x2ab8cf['style'][_0x4173ab(0x17a)]=_0x4173ab(0x14d),_0x2ab8cf['style'][_0x4173ab(0x178)]=_0x4173ab(0x145),_0x2ab8cf[_0x4173ab(0x1a0)][_0x4173ab(0x195)]=_0x4173ab(0x145),_0x2ab8cf[_0x4173ab(0x1a0)]['gap']=_0x4173ab(0x16c),_0x2ab8cf[_0x4173ab(0x1a0)][_0x4173ab(0x15a)]=_0x4173ab(0x176),_0x2ab8cf[_0x4173ab(0x1a0)]['zIndex']='10000',_0x2ab8cf[_0x4173ab(0x1a0)][_0x4173ab(0x159)]=_0x4173ab(0x15c),_0x2ab8cf[_0x4173ab(0x1a0)][_0x4173ab(0x177)]=_0x4173ab(0x16d),_0x2ab8cf[_0x4173ab(0x1a0)][_0x4173ab(0x1a5)]=_0x4173ab(0x199);let _0x2645bc=create_status_box();const _0x256914=document[_0x4173ab(0x19f)](_0x4173ab(0x1a0));_0x256914[_0x4173ab(0x152)]=_0x4173ab(0x168),document['head'][_0x4173ab(0x13e)](_0x256914),_0x2ab8cf[_0x4173ab(0x13e)](_0xa540cc),_0x2ab8cf[_0x4173ab(0x13e)](_0x2645bc);let _0x564050=document[_0x4173ab(0x161)](_0x4173ab(0x16b)),_0x521d3c=_0x564050[_0x4173ab(0x18d)];return _0x564050[_0x4173ab(0x1a1)](_0x2ab8cf,_0x521d3c),_0x2ab8cf;}const throttlePromises=async(_0x343734,_0x4321fa)=>{const _0x1f4840=a0_0x594daf;while(_0x343734[_0x1f4840(0x1a3)]>0x0){await Promise[_0x1f4840(0x167)](_0x343734['splice'](0x0,_0x4321fa)[_0x1f4840(0x185)](_0x14eb14=>_0x14eb14())),await sleep(0xc8);}},tinh_x_client_time=()=>{const _0x13f346=a0_0x594daf,_0x3b1c19=new Date(),_0x5bf341=-0x7*0x3c,_0x32743b=Math['floor'](Math['abs'](_0x5bf341)/0x3c)[_0x13f346(0x141)]()['padStart'](0x2,'0'),_0xe452e2=Math[_0x13f346(0x191)](_0x5bf341)%0x3c,_0x1a26d3=_0x5bf341>=0x0?'-':'+',_0x3e8957=''+_0x1a26d3+_0x32743b+':'+_0xe452e2[_0x13f346(0x141)]()['padStart'](0x2,'0'),_0x193a08=''+_0x3b1c19[_0x13f346(0x194)]()[_0x13f346(0x162)]('.')[0x0]+_0x3e8957;return'2023-09-12T18:42:14+07:00';},tinh_x_client_hash=async _0x1066f1=>{const _0x2a2b3c=a0_0x594daf;let _0x1d8725=globalThis[_0x2a2b3c(0x148)],_0xf0ed56=new TextEncoder()['encode'](''['concat'](_0x1066f1)['concat'](_0x2a2b3c(0x180))),_0x4eb8aa=await _0x1d8725['subtle']['digest'](_0x2a2b3c(0x190),_0xf0ed56),_0x398d9f=Array['from'](new Uint8Array(_0x4eb8aa))['map'](_0xa34bf3=>_0xa34bf3[_0x2a2b3c(0x141)](0x10)[_0x2a2b3c(0x181)](0x2,'0'))[_0x2a2b3c(0x158)]('');return _0x398d9f;};((async()=>{const _0x6aac8a=a0_0x594daf,_0x2f2d8b=document['location'][_0x6aac8a(0x140)],_0x3c2088=_0x2f2d8b['match'](/\/stories\/(\d+)/)[0x1],_0x4a9368=_0x6aac8a(0x17c)+_0x3c2088+_0x6aac8a(0x142),_0x113445=tinh_x_client_time(),_0x279091=await tinh_x_client_hash(_0x113445),_0x1e0771=await fetch(_0x4a9368,{'method':_0x6aac8a(0x198),'headers':{'x-client-hash':_0x279091,'x-client-time':_0x113445,'x-requested-with':_0x6aac8a(0x173)}}),_0x301d6e=await _0x1e0771[_0x6aac8a(0x19b)](),{reading_episode:_0x52d60e}=_0x301d6e[_0x6aac8a(0x157)],_0x30ed02=[];for(const [_0x1b33f3,_0x29afa0]of _0x52d60e[_0x6aac8a(0x15f)][_0x6aac8a(0x197)]()){_0x30ed02[_0x6aac8a(0x150)](_0x29afa0);}if(_0x30ed02[_0x6aac8a(0x1a3)]>0x0){downloading_total=_0x30ed02[_0x6aac8a(0x1a3)];const _0x340c53=create_download_icon();_0x340c53[_0x6aac8a(0x147)]('click',async()=>{const _0x5598b5=_0x6aac8a;downloading_current=0x0;const _0x3e4fa8=_0x30ed02[_0x5598b5(0x185)]((_0x1ba1f7,_0x3dc732)=>()=>download_not_encrypted(_0x1ba1f7,_0x3dc732));await throttlePromises(_0x3e4fa8,0x2);});}})());function a0_0x4394(){const _0xa274f=['createElement','style','insertBefore','25864AWjEtx','length','head','transform','key','12TVDodw','https://fonts.googleapis.com/css2?family=Acme&display=swap','appendChild','Failed\x20to\x20reverse\x20shuffle\x20table','href','toString','/read_v3','781980oCPCvr','\x20/\x20','center','status-num','addEventListener','crypto','subtle','toBlob','https://github.com/NAgEustiCa/1_con_kien_2_con_kien/raw/main/tai_icon.png','getContext','flex','block','from','push','createObjectURL','textContent','5574793mISsaY','status','cursor','URL','data','join','top','position','6256704VKGZUi','0.5rem','floor','src','pages','8649AiMtle','querySelector','split','webkitURL','ceil','link','50aXxTnm','all','\x0a\x20\x20\x20\x20\x20\x20\x20\x20.status-num\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27Acme\x27,\x20sans-serif\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x203rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#FD7377;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-webkit-text-stroke:\x201px\x20#C62428;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x200.2rem\x20solid\x20#167975;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x201rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x200\x202rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background-color:\x20#F9FDFD;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200.25rem\x200.4rem\x20#2E8B87;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20','canvas','getImageData','body','1.5rem','50vw','gridsize','putImageData','getElementsByTagName','15780IkRxOF','4wXCKprMMoxnyJ3PocJFs4CYbfnbazNe','pixivcomic','next','width','absolute','left','justifyContent','.status-num','display','setAttribute','https://comic.pixiv.net/api/app/episodes/','innerHTML','https://comic.pixiv.net/','img','mAtW1X8SzGS880fsjEXlM73QpS1i4kUMBhyhdaYySk8nWz533nrEunaSplg63fzT','padStart','concat','indexOf','3rem','map','rel','seed.length\x20!==\x204\x20(seed.length:\x20','className','image/jpeg','stylesheet','height','118808HaWODv','firstChild','223056NFSxch','.jpg','SHA-256','abs','url','fill','toISOString','alignItems','encode','entries','GET','translate(-50%)','pointer','json','some','keys','div'];a0_0x4394=function(){return _0xa274f;};return a0_0x4394();}
