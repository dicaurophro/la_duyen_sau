// ==UserScript==
// @name         p-i-x-i-v
// @namespace    https://github.com/dicaurophro/la_duyen_sau/raw/main/p-i-x-i-v.user.js
// @version      2023.09.13
// @description  down p-i-x-i-v
// @author       You
// @match        https://comic.pixiv.net/viewer/stories/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=comic.pixiv.net
// @require      https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js
// @grant        none
// @downloadURL  https://github.com/dicaurophro/la_duyen_sau/raw/main/p-i-x-i-v.user.js
// @updateURL    https://github.com/dicaurophro/la_duyen_sau/raw/main/p-i-x-i-v.meta.js
// ==/UserScript==

function a0_0x2adf(){const _0x253b06=['insertBefore','padStart','0.5rem','zIndex','107558ykoxdY','absolute','display','Failed\x20to\x20reverse\x20shuffle\x20table','4wXCKprMMoxnyJ3PocJFs4CYbfnbazNe','map','from','fill','24KRuQzD','1615047ycJUNh','concat','crypto','click','position','https://comic.pixiv.net/api/app/episodes/','drawImage','30NPGXOH','match','subtle','GET','floor','rel','toBlob','pointer','\x0a\x20\x20\x20\x20\x20\x20\x20\x20.status-num\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27Acme\x27,\x20sans-serif\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x203rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#FD7377;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-webkit-text-stroke:\x201px\x20#C62428;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x200.2rem\x20solid\x20#167975;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x201rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x200\x202rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background-color:\x20#F9FDFD;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200.25rem\x200.4rem\x20#2E8B87;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20','33bNxRsI','createElement','firstChild','height','img','url','blob','width','setAttribute','alignItems','all','keys','encode','11862DtLKyv','SHA-256','some','addEventListener','URL','pixivcomic','join','push','.status-num','/read_v3','4626281DaQKis','https://comic.pixiv.net/','querySelector','next','\x20/\x20','div','ceil','src','getImageData','https://fonts.googleapis.com/css2?family=Acme&display=swap','2744064JQuwtk','appendChild','justifyContent','block','5JBgZQD','innerHTML','transform','style','pages','length','3rem','265800OvLuNe','json','body','status-num','onload','digest','head','key','center','href','createObjectURL','textContent','seed.length\x20!==\x204\x20(seed.length:\x20','top','canvas','splice','webkitURL','abs','split','indexOf','image/jpeg','gridsize','toString','location','https://github.com/NAgEustiCa/1_con_kien_2_con_kien/raw/main/tai_icon.png','left','6017192temJmz','className'];a0_0x2adf=function(){return _0x253b06;};return a0_0x2adf();}(function(_0x240316,_0x3255aa){const _0x3e41ed=a0_0x5e69,_0xf5aaf9=_0x240316();while(!![]){try{const _0x1bc18f=-parseInt(_0x3e41ed(0x1bf))/0x1+-parseInt(_0x3e41ed(0x1fe))/0x2*(parseInt(_0x3e41ed(0x1b2))/0x3)+parseInt(_0x3e41ed(0x1de))/0x4*(parseInt(_0x3e41ed(0x1d7))/0x5)+-parseInt(_0x3e41ed(0x206))/0x6*(-parseInt(_0x3e41ed(0x207))/0x7)+-parseInt(_0x3e41ed(0x1f8))/0x8+-parseInt(_0x3e41ed(0x1d3))/0x9+-parseInt(_0x3e41ed(0x20e))/0xa*(-parseInt(_0x3e41ed(0x1c9))/0xb);if(_0x1bc18f===_0x3255aa)break;else _0xf5aaf9['push'](_0xf5aaf9['shift']());}catch(_0xe0278f){_0xf5aaf9['push'](_0xf5aaf9['shift']());}}}(a0_0x2adf,0x902eb));let downloading_current=0x0,downloading_total=0x0;function sleep(_0x4c4c57){return new Promise(_0x55ae6f=>setTimeout(_0x55ae6f,_0x4c4c57));}function tj(_0x359609,_0x32c1c4){return(_0x359609<<(_0x32c1c4%=0x20)>>>0x0|_0x359609>>>0x20-_0x32c1c4)>>>0x0;}class ty{['next'](){let _0x330372=0x9*tj(0x5*this['s'][0x1]>>>0x0,0x7)>>>0x0,_0x5b9270=this['s'][0x1]<<0x9>>>0x0;return this['s'][0x2]=(this['s'][0x2]^this['s'][0x0])>>>0x0,this['s'][0x3]=(this['s'][0x3]^this['s'][0x1])>>>0x0,this['s'][0x1]=(this['s'][0x1]^this['s'][0x2])>>>0x0,this['s'][0x0]=(this['s'][0x0]^this['s'][0x3])>>>0x0,this['s'][0x2]=(this['s'][0x2]^_0x5b9270)>>>0x0,this['s'][0x3]=tj(this['s'][0x3],0xb),_0x330372;}constructor(_0xe7fd5a){const _0x4d1ce6=a0_0x5e69;if(0x4!==_0xe7fd5a[_0x4d1ce6(0x1dc)])throw Error(_0x4d1ce6(0x1ea)['concat'](_0xe7fd5a['length'],')'));this['s']=new Uint32Array(_0xe7fd5a),0x0===this['s'][0x0]&&0x0===this['s'][0x1]&&0x0===this['s'][0x2]&&0x0===this['s'][0x3]&&(this['s'][0x0]=0x1);}}async function t_(_0x16e2fc,_0x10f28b,_0x14c4d9,_0x23ccba,_0x312338,_0x515aac,_0x50a872,_0x41b5b6,_0x42d368){const _0x312dd3=a0_0x5e69;let _0x2eb4d8=globalThis['crypto'],_0x1ec79e=Math[_0x312dd3(0x1cf)](_0x23ccba/_0x515aac),_0x52a820=Math[_0x312dd3(0x212)](_0x14c4d9/_0x312338),_0x52719d=Array(_0x1ec79e)[_0x312dd3(0x205)](null)[_0x312dd3(0x203)](()=>Array[_0x312dd3(0x204)](Array(_0x52a820)[_0x312dd3(0x1bd)]()));{let _0x21dc2f=new TextEncoder()[_0x312dd3(0x1be)](_0x50a872+_0x41b5b6),_0x3fffc2=await _0x2eb4d8[_0x312dd3(0x210)][_0x312dd3(0x1e3)](_0x312dd3(0x1c0),_0x21dc2f),_0x63efef=new Uint32Array(_0x3fffc2,0x0,0x4),_0x435286=new ty(_0x63efef);for(let _0x31a40f=0x0;_0x31a40f<0x64;_0x31a40f++)_0x435286['next']();for(let _0xc607f4=0x0;_0xc607f4<_0x1ec79e;_0xc607f4++){let _0x4eb551=_0x52719d[_0xc607f4];for(let _0x18fe39=_0x52a820-0x1;_0x18fe39>=0x1;_0x18fe39--){let _0x3c9fe1=_0x435286[_0x312dd3(0x1cc)]()%(_0x18fe39+0x1),_0x4a18a3=_0x4eb551[_0x18fe39];_0x4eb551[_0x18fe39]=_0x4eb551[_0x3c9fe1],_0x4eb551[_0x3c9fe1]=_0x4a18a3;}}}if(_0x42d368)for(let _0x2f4cfd=0x0;_0x2f4cfd<_0x1ec79e;_0x2f4cfd++){let _0x31b3a8=_0x52719d[_0x2f4cfd],_0x1ca8e2=_0x31b3a8[_0x312dd3(0x203)]((_0x281d9c,_0x5ae1ae)=>_0x31b3a8[_0x312dd3(0x1f1)](_0x5ae1ae));if(_0x1ca8e2[_0x312dd3(0x1c1)](_0x7c60ca=>_0x7c60ca<0x0))throw Error(_0x312dd3(0x201));_0x52719d[_0x2f4cfd]=_0x1ca8e2;}let _0x3faa6a=new Uint8ClampedArray(_0x16e2fc[_0x312dd3(0x1dc)]);for(let _0xa13480=0x0;_0xa13480<_0x23ccba;_0xa13480++){let _0x21c164=Math[_0x312dd3(0x212)](_0xa13480/_0x515aac),_0x23e141=_0x52719d[_0x21c164];for(let _0x5bffb6=0x0;_0x5bffb6<_0x52a820;_0x5bffb6++){let _0x9f394f=_0x23e141[_0x5bffb6],_0x3005a9=_0x5bffb6*_0x312338,_0x30684e=(_0xa13480*_0x14c4d9+_0x3005a9)*_0x10f28b,_0x144e59=_0x9f394f*_0x312338,_0x1e82a0=(_0xa13480*_0x14c4d9+_0x144e59)*_0x10f28b,_0x4ba465=_0x312338*_0x10f28b;for(let _0x2c0dfa=0x0;_0x2c0dfa<_0x4ba465;_0x2c0dfa++)_0x3faa6a[_0x30684e+_0x2c0dfa]=_0x16e2fc[_0x1e82a0+_0x2c0dfa];}{let _0x3e6f25=_0x52a820*_0x312338,_0x25ba64=(_0xa13480*_0x14c4d9+_0x3e6f25)*_0x10f28b,_0x2c2dd2=(_0xa13480*_0x14c4d9+_0x14c4d9)*_0x10f28b;for(let _0x30a961=_0x25ba64;_0x30a961<_0x2c2dd2;_0x30a961++)_0x3faa6a[_0x30a961]=_0x16e2fc[_0x30a961];}}return _0x3faa6a;}function a0_0x5e69(_0x1cdc26,_0x4354e1){const _0x2adf55=a0_0x2adf();return a0_0x5e69=function(_0x5e6964,_0x412a09){_0x5e6964=_0x5e6964-0x1af;let _0x5e6df8=_0x2adf55[_0x5e6964];return _0x5e6df8;},a0_0x5e69(_0x1cdc26,_0x4354e1);}const download_not_encrypted=async(_0x6ee509,_0x3fd51e)=>{const _0x18f979=a0_0x5e69,_0x2b36ab=await fetch(_0x6ee509[_0x18f979(0x1b7)],{'method':_0x18f979(0x211),'headers':{'X-Cobalt-Thumber-Parameter-GridShuffle-Key':_0x6ee509['key'],'referer':_0x18f979(0x1ca)}}),_0x472e97=await _0x2b36ab[_0x18f979(0x1b8)](),_0x5787dc=window[_0x18f979(0x1c3)]||window[_0x18f979(0x1ee)],_0x40af01=_0x5787dc[_0x18f979(0x1e8)](_0x472e97);let _0x2ffcf3=new Image(_0x6ee509[_0x18f979(0x1b9)],_0x6ee509['height']);_0x2ffcf3[_0x18f979(0x1e2)]=async()=>{const _0x28be6b=_0x18f979,_0x1e08b7=document[_0x28be6b(0x1b3)](_0x28be6b(0x1ec));let _0xe3f48a=_0x1e08b7['getContext']('2d');_0x1e08b7[_0x28be6b(0x1b9)]=_0x6ee509['width'],_0x1e08b7['height']=_0x6ee509[_0x28be6b(0x1b5)],_0xe3f48a[_0x28be6b(0x20d)](_0x2ffcf3,0x0,0x0);let _0x5d793a=_0xe3f48a[_0x28be6b(0x1d1)](0x0,0x0,_0x6ee509[_0x28be6b(0x1b9)],_0x6ee509[_0x28be6b(0x1b5)]),_0x4b4731=await t_(_0x5d793a['data'],0x4,_0x6ee509[_0x28be6b(0x1b9)],_0x6ee509[_0x28be6b(0x1b5)],_0x6ee509[_0x28be6b(0x1f3)],_0x6ee509[_0x28be6b(0x1f3)],_0x28be6b(0x202),_0x6ee509[_0x28be6b(0x1e5)],!0x0),_0x2e4091=new ImageData(_0x4b4731,_0x6ee509[_0x28be6b(0x1b9)],_0x6ee509[_0x28be6b(0x1b5)]);_0xe3f48a['putImageData'](_0x2e4091,0x0,0x0),_0x1e08b7[_0x28be6b(0x1af)](_0x206026=>{const _0x778e50=_0x28be6b;saveAs(_0x206026,(''+(_0x3fd51e+0x1))[_0x778e50(0x1fb)](0x3,'0')+'.jpg'),downloading_current+=0x1,update_status();},_0x28be6b(0x1f2),0.97);},_0x2ffcf3[_0x18f979(0x1d0)]=_0x40af01;};function update_status(){const _0x203b5e=a0_0x5e69;document[_0x203b5e(0x1cb)]('.status-num')[_0x203b5e(0x1da)][_0x203b5e(0x200)]=_0x203b5e(0x1d6),document[_0x203b5e(0x1cb)](_0x203b5e(0x1c7))[_0x203b5e(0x1d8)]=downloading_current+_0x203b5e(0x1cd)+downloading_total;}function create_status_box(){const _0x354b9c=a0_0x5e69;let _0x22709d=document[_0x354b9c(0x1b3)](_0x354b9c(0x1ce));return _0x22709d['className']=_0x354b9c(0x1e1),_0x22709d[_0x354b9c(0x1e9)]=downloading_current+_0x354b9c(0x1cd)+downloading_total,_0x22709d;}function create_download_icon(){const _0x1744b9=a0_0x5e69;let _0x55d5c8=document[_0x1744b9(0x1b3)](_0x1744b9(0x1ce)),_0x30db36=document['createElement'](_0x1744b9(0x1b6));_0x30db36[_0x1744b9(0x1ba)](_0x1744b9(0x1d0),_0x1744b9(0x1f6)),_0x30db36[_0x1744b9(0x1da)]['width']=_0x1744b9(0x1dd),_0x30db36['style']['cursor']=_0x1744b9(0x1b0),_0x55d5c8[_0x1744b9(0x1d4)](_0x30db36);let _0x1fb6a0=document['createElement']('link');_0x1fb6a0[_0x1744b9(0x213)]='stylesheet',_0x1fb6a0[_0x1744b9(0x1e7)]=_0x1744b9(0x1d2),document['getElementsByTagName'](_0x1744b9(0x1e4))[0x0][_0x1744b9(0x1d4)](_0x1fb6a0);let _0x509aa6=document[_0x1744b9(0x1b3)](_0x1744b9(0x1ce));_0x509aa6[_0x1744b9(0x1f9)]='status',_0x509aa6[_0x1744b9(0x1da)][_0x1744b9(0x200)]='flex',_0x509aa6[_0x1744b9(0x1da)][_0x1744b9(0x1d5)]=_0x1744b9(0x1e6),_0x509aa6[_0x1744b9(0x1da)][_0x1744b9(0x1bb)]=_0x1744b9(0x1e6),_0x509aa6[_0x1744b9(0x1da)]['gap']='1.5rem',_0x509aa6[_0x1744b9(0x1da)][_0x1744b9(0x20b)]=_0x1744b9(0x1ff),_0x509aa6[_0x1744b9(0x1da)][_0x1744b9(0x1fd)]='10000',_0x509aa6['style'][_0x1744b9(0x1eb)]=_0x1744b9(0x1fc),_0x509aa6[_0x1744b9(0x1da)][_0x1744b9(0x1f7)]='50vw',_0x509aa6[_0x1744b9(0x1da)][_0x1744b9(0x1d9)]='translate(-50%)';let _0x23a2fb=create_status_box();const _0x23fceb=document[_0x1744b9(0x1b3)](_0x1744b9(0x1da));_0x23fceb['textContent']=_0x1744b9(0x1b1),document['head'][_0x1744b9(0x1d4)](_0x23fceb),_0x509aa6[_0x1744b9(0x1d4)](_0x55d5c8),_0x509aa6[_0x1744b9(0x1d4)](_0x23a2fb);let _0x5cdca2=document[_0x1744b9(0x1cb)](_0x1744b9(0x1e0)),_0x2935e3=_0x5cdca2[_0x1744b9(0x1b4)];return _0x5cdca2[_0x1744b9(0x1fa)](_0x509aa6,_0x2935e3),_0x509aa6;}const throttlePromises=async(_0x181224,_0x5e3257)=>{const _0x333786=a0_0x5e69;while(_0x181224[_0x333786(0x1dc)]>0x0){await Promise[_0x333786(0x1bc)](_0x181224[_0x333786(0x1ed)](0x0,_0x5e3257)[_0x333786(0x203)](_0x1987e7=>_0x1987e7())),await sleep(0xc8);}},tinh_x_client_time=()=>{const _0x36b7ba=a0_0x5e69,_0x326850=new Date(),_0x5871d7=-0x7*0x3c,_0x452384=Math['floor'](Math[_0x36b7ba(0x1ef)](_0x5871d7)/0x3c)[_0x36b7ba(0x1f4)]()[_0x36b7ba(0x1fb)](0x2,'0'),_0x2aa614=Math[_0x36b7ba(0x1ef)](_0x5871d7)%0x3c,_0x16c1c5=_0x5871d7>=0x0?'-':'+',_0x80e2ab=''+_0x16c1c5+_0x452384+':'+_0x2aa614['toString']()[_0x36b7ba(0x1fb)](0x2,'0'),_0x5e4e18=''+_0x326850['toISOString']()[_0x36b7ba(0x1f0)]('.')[0x0]+_0x80e2ab;return _0x5e4e18;},tinh_x_client_hash=async _0x30dab9=>{const _0x898e25=a0_0x5e69;let _0x52ee7d=globalThis[_0x898e25(0x209)],_0x5b2a10=new TextEncoder()[_0x898e25(0x1be)](''[_0x898e25(0x208)](_0x30dab9)[_0x898e25(0x208)]('mAtW1X8SzGS880fsjEXlM73QpS1i4kUMBhyhdaYySk8nWz533nrEunaSplg63fzT')),_0x1c787b=await _0x52ee7d[_0x898e25(0x210)][_0x898e25(0x1e3)]('SHA-256',_0x5b2a10),_0x7c57b3=Array[_0x898e25(0x204)](new Uint8Array(_0x1c787b))['map'](_0x58b744=>_0x58b744[_0x898e25(0x1f4)](0x10)['padStart'](0x2,'0'))[_0x898e25(0x1c5)]('');return _0x7c57b3;};((async()=>{const _0x39e896=a0_0x5e69,_0x1ae386=document[_0x39e896(0x1f5)]['href'],_0x4ab87=_0x1ae386[_0x39e896(0x20f)](/\/stories\/(\d+)/)[0x1],_0x4364cb=_0x39e896(0x20c)+_0x4ab87+_0x39e896(0x1c8),_0x37db9d=tinh_x_client_time(),_0x376d90=await tinh_x_client_hash(_0x37db9d),_0x13a48b=await fetch(_0x4364cb,{'method':_0x39e896(0x211),'headers':{'x-client-hash':_0x376d90,'x-client-time':_0x37db9d,'x-requested-with':_0x39e896(0x1c4)}}),_0x41f3aa=await _0x13a48b[_0x39e896(0x1df)](),{reading_episode:_0x380b1c}=_0x41f3aa['data'],_0x25a116=[];for(const [_0x2fdc9f,_0x284691]of _0x380b1c[_0x39e896(0x1db)]['entries']()){_0x25a116[_0x39e896(0x1c6)](_0x284691);}if(_0x25a116[_0x39e896(0x1dc)]>0x0){downloading_total=_0x25a116[_0x39e896(0x1dc)];const _0x2d143d=create_download_icon();_0x2d143d[_0x39e896(0x1c2)](_0x39e896(0x20a),async()=>{const _0x5cbcd=_0x39e896;downloading_current=0x0;const _0x241703=_0x25a116[_0x5cbcd(0x203)]((_0x3cde14,_0x199815)=>()=>download_not_encrypted(_0x3cde14,_0x199815));await throttlePromises(_0x241703,0x2);});}})());